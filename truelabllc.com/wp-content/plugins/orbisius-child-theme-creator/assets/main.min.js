function orbisius_ctc_theme_editor_setup(){var a=jQuery,b=window.onbeforeunload;a(window).on("beforeunload",function(a){var c="";return jQuery("#theme_1_file_contents").data("orb_ctc_modified_content")?c="Left Editor: Content was modified. Are you sure you want to leave without saving?":jQuery("#theme_2_file_contents").data("orb_ctc_modified_content")&&(c="Right Editor: Content was modified. Are you sure you want to leave without saving?"),""!=c?(a.returnValue=c,c):"undefined"!=typeof b?b(a):void 0});var c=a("#theme_1").val();""!=c&&app_load("#orbisius_ctc_theme_editor_theme_1_form","generate_dropdown","#theme_1_file",app_handle_theme_change),a("#theme_1_file_contents,#theme_2_file_contents").on("keyup keypress input paste",function(b){var c={target:a(this),event:b};jQuery(document).trigger("orbisius_child_theme_editor_event_content_updated",[c])}),jQuery(document).on("orbisius_child_theme_editor_event_content_updated",function(a,b){jQuery(b.target).data("orb_ctc_modified_content",1),jQuery(b.target).addClass("modified_content")}),jQuery(document).on("orbisius_child_theme_editor_event_content_saved",function(a,b){jQuery(b.target).removeData("orb_ctc_modified_content"),jQuery(b.target).removeClass("modified_content")}),a("#theme_1_delete_file_btn").on("click",function(){var b=a("#theme_1_file").val();confirm("Delete: ["+b+"] ? Are you sure?","")&&orbisius_child_theme_creator.delete_file(b,"#orbisius_ctc_theme_editor_theme_1_form")}),a("#theme_2_delete_file_btn").on("click",function(){var b=a("#theme_2_file").val();confirm("Delete: ["+b+"] ? Are you sure?","")&&orbisius_child_theme_creator.delete_file(b,"#orbisius_ctc_theme_editor_theme_2_form")}),a("#theme_1_new_file_btn").on("click",function(){a("#theme_1_new_file_container").toggle("slow"),a("#theme_1_new_file").focus()}),a("#theme_1_new_file").on("input",function(b){var c=a("#theme_1_new_file").val();c=orbisius_child_theme_creator.sanitize_file_name(c);var d=1;if(a("#theme_1_file option").each(function(){var b=a(this).val();if(b==c)return void(d=0)}),d)a(".status",a("#theme_1_new_file_container")).text("").removeClass("app-alert-error");else{var e="File with that name already exists.";a(".status",a("#theme_1_new_file_container")).text(e).addClass("app-alert-error")}}),a("#theme_1_new_file_btn_ok").on("click",function(){var b=a("#theme_1_new_file").val();b=orbisius_child_theme_creator.sanitize_file_name(b);var c=b;if(""==b)return alert("Invalid or empty value for filename."),void a("#theme_1_new_file").focus();var d=1;if(a("#theme_1_file option").each(function(){var c=a(this).val();if(c==b)return void(d=0)}),!d)return alert("File with that name already exists."),void a("#theme_1_new_file").focus();a("select theme_1_file").prop("selected",!1);var e=a("<option></option>").val(b).html(c).prop("selected",!0);a("#theme_1_file").append(e),a("#theme_1_new_file_container").hide("slow"),a("#theme_1_new_file").val(""),a("#theme_1_file_contents").val("").focus();var f={file:b,file_selector:"#theme_1_file",content_selector:"#theme_1_file_contents"};jQuery(document).trigger("orbisius_child_theme_editor_event_new_file",[f])}),jQuery(document).on("orbisius_child_theme_editor_event_new_file",function(b,c){a("html, body").animate({scrollTop:jQuery(c.file_selector).offset().top-50},1e3)}),a("#theme_1_new_file_btn_cancel").on("click",function(){a("#theme_1_new_file").val(""),a("#theme_1_new_file_container").hide("slow"),a(".status",a("#theme_1_new_file_container")).text("").removeClass("app-alert-error")}),a("#theme_2_new_file_btn").on("click",function(){a("#theme_2_new_file_container").toggle("slow"),a("#theme_2_new_file").focus()}),a("#theme_2_new_file").on("input",function(b){var c=a("#theme_2_new_file").val();c=orbisius_child_theme_creator.sanitize_file_name(c);var d=1;if(a("#theme_2_file option").each(function(){var b=a(this).val();if(b==c)return void(d=0)}),d)a(".status",a("#theme_2_new_file_container")).text("").removeClass("app-alert-error");else{var e="File with that name already exists.";a(".status",a("#theme_2_new_file_container")).text(e).addClass("app-alert-error")}}),a("#theme_2_new_file_btn_ok").on("click",function(){var b=a("#theme_2_new_file").val();b=orbisius_child_theme_creator.sanitize_file_name(b);var c=b;if(""==b)return alert("Invalid or empty value for filename."),void a("#theme_2_new_file").focus();var d=1;if(a("#theme_2_file option").each(function(){var c=a(this).val();if(c==b)return void(d=0)}),!d)return alert("File with that name already exists."),void a("#theme_2_new_file").focus();a("select theme_2_file").prop("selected",!1);var e=a("<option></option>").val(b).html(c).prop("selected",!0);a("#theme_2_file").append(e),a("#theme_2_new_file_container").hide("slow"),a("#theme_2_new_file").val(""),a("#theme_2_file_contents").val("").focus();var f={file:b,file_selector:"#theme_2_file",content_selector:"#theme_2_file_contents"};jQuery(document).trigger("orbisius_child_theme_editor_event_new_file",[f])}),a("#theme_2_new_file_btn_cancel").on("click",function(){a("#theme_2_new_file").val(""),a("#theme_2_new_file_container").hide("slow"),a(".status",a("#theme_2_new_file_container")).text("").removeClass("app-alert-error")}),a("#theme_1_syntax_chk_btn").on("click",function(){var a="#orbisius_ctc_theme_editor_theme_1_form",b="syntax_check",c=".orbisius_ctc_theme_editor_theme_1_primary_buttons .status";jQuery(c).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Checking ..."),jQuery.ajax({type:"post",url:ajaxurl,data:jQuery(a).serialize()+"&action=orbisius_ctc_theme_editor_ajax&sub_cmd="+escape(b),beforeSend:function(){orbisius_child_theme_creator.loader(1)},complete:function(){orbisius_child_theme_creator.loader(0)},success:function(a){jQuery(c).empty().removeClass("app-alert-notice").html(a.msg).addClass(a.status?"app-alert-success":"app-alert-error"),a.status&&setTimeout(function(){jQuery(c).empty().removeClass("app-alert-success app-alert-error")},2e3)}})}),a("#theme_2_syntax_chk_btn").on("click",function(){var a="#orbisius_ctc_theme_editor_theme_2_form",b="syntax_check",c=".orbisius_ctc_theme_editor_theme_2_primary_buttons .status";jQuery(c).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Checking ..."),jQuery.ajax({type:"post",url:ajaxurl,data:jQuery(a).serialize()+"&action=orbisius_ctc_theme_editor_ajax&sub_cmd="+escape(b),beforeSend:function(){orbisius_child_theme_creator.loader(1)},complete:function(){orbisius_child_theme_creator.loader(0)},success:function(a){jQuery(c).empty().removeClass("app-alert-notice").html(a.msg).addClass(a.status?"app-alert-success":"app-alert-error"),a.status&&setTimeout(function(){jQuery(c).empty().removeClass("app-alert-success app-alert-error")},2e3)}})}),a("#theme_1_send_btn").on("click",function(){a("#theme_1_send_container").toggle("slow"),a("#theme_1_send_to").focus()}),a("#theme_1_send_btn_cancel").on("click",function(){a("#theme_1_send_container").hide("slow")}),a("#theme_1_send_btn_ok").on("click",function(){var b=jQuery("#theme_1_send_to").val().trim();if(b.indexOf("@")==-1||b.indexOf(".")<1)return alert("Invalid email(s)."),void a("#theme_1_send_to").focus();var c="#orbisius_ctc_theme_editor_theme_1_form",d="send_theme",e=".orbisius_ctc_theme_editor_theme_1_primary_buttons .status";jQuery(e).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Processing ..."),jQuery.ajax({type:"post",url:ajaxurl,data:jQuery(c).serialize()+"&action=orbisius_ctc_theme_editor_ajax&sub_cmd="+escape(d),beforeSend:function(){orbisius_child_theme_creator.loader(1)},complete:function(){orbisius_child_theme_creator.loader(0)},success:function(b){jQuery(e).empty().removeClass("app-alert-notice").html(b.msg).addClass(b.status?"app-alert-success":"app-alert-error"),b.status&&setTimeout(function(){jQuery(e).empty().removeClass("app-alert-success app-alert-error"),a("#theme_1_send_btn_cancel").click()},2e3)}})}),a("#theme_2_send_btn").on("click",function(){a("#theme_2_send_container").toggle("slow"),a("#theme_2_send_to").focus()}),a("#theme_2_send_btn_cancel").on("click",function(){a("#theme_2_send_container").hide("slow")}),a("#theme_2_send_btn_ok").on("click",function(){var b=jQuery("#theme_2_send_to").val().trim();if(b.indexOf("@")==-1||b.indexOf(".")<1)return alert("Invalid email(s)."),void a("#theme_2_send_to").focus();var c="#orbisius_ctc_theme_editor_theme_2_form",d="send_theme",e=".orbisius_ctc_theme_editor_theme_2_primary_buttons .status";jQuery(e).empty().removeClass("app-alert-success app-alert-error app-alert-notice").addClass("app-alert-notice").html("Processing ..."),jQuery.ajax({type:"post",url:ajaxurl,data:jQuery(c).serialize()+"&action=orbisius_ctc_theme_editor_ajax&sub_cmd="+escape(d),beforeSend:function(){orbisius_child_theme_creator.loader(1)},complete:function(){orbisius_child_theme_creator.loader(0)},success:function(b){jQuery(e).empty().removeClass("app-alert-notice").html(b.msg).addClass(b.status?"app-alert-success":"app-alert-error"),b.status&&setTimeout(function(){jQuery(e).empty().removeClass("app-alert-success app-alert-error"),a("#theme_2_send_btn_cancel").click()},2e3)}})}),a("#theme_1_new_folder_btn").on("click",function(){a("#theme_1_new_folder_container").toggle("slow"),a("#theme_1_new_folder").focus()}),a("#theme_2_new_folder_btn").on("click",function(){a("#theme_2_new_folder_container").toggle("slow"),a("#theme_2_new_folder").focus()}),a("#theme_1_new_folder").on("input",function(b){var c=a("#theme_1_new_folder").val();c=orbisius_child_theme_creator.sanitize_file_name(c);var d=1;if(a("#theme_1_file option").each(function(){var b=a(this).val();if(b==c)return void(d=0)}),d)a(".status",a("#theme_1_new_folder_container")).text("").removeClass("app-alert-error");else{var e="File/folder with that name already exists.";a(".status",a("#theme_1_new_folder_container")).text(e).addClass("app-alert-error")}}),a("#theme_2_new_folder").on("input",function(b){var c=a("#theme_2_new_folder").val();c=orbisius_child_theme_creator.sanitize_file_name(c);var d=1;if(a("#theme_2_file option").each(function(){var b=a(this).val();if(b==c)return void(d=0)}),d)a(".status",a("#theme_2_new_folder_container")).text("").removeClass("app-alert-error");else{var e="File/folder with that name already exists.";a(".status",a("#theme_2_new_folder_container")).text(e).addClass("app-alert-error")}}),a("#theme_1_new_folder_btn_ok").on("click",function(){var b=a("#theme_1_new_folder").val();b=orbisius_child_theme_creator.sanitize_file_name(b);var c=b;if(""==b)return alert("Invalid or empty value for folder name."),void a("#theme_1_new_folder").focus();var d=1;if(a("#theme_1_folder option").each(function(){var c=a(this).val();if(c==b)return void(d=0)}),!d)return alert("File with that name already exists."),void a("#theme_1_new_folder").focus();a("select theme_1_folder").prop("selected",!1);var e=a("<option></option>").val(b).html(c).prop("selected",!0);a("#theme_1_folder").append(e),a("#theme_1_new_folder_container").hide("slow"),a("#theme_1_new_folder").val(""),a("#theme_1_folder_contents").val("").focus()}),a("#theme_1_new_folder_btn_cancel").on("click",function(){a("#theme_1_new_folder").val(""),a("#theme_1_new_folder_container").hide("slow"),a(".status",a("#theme_1_new_folder_container")).text("").removeClass("app-alert-error")}),a("#theme_2_new_folder_btn_ok").on("click",function(){var b=a("#theme_2_new_folder").val();b=orbisius_child_theme_creator.sanitize_file_name(b);var c=b;if(""==b)return alert("Invalid or empty value for folder name."),void a("#theme_2_new_folder").focus();var d=1;if(a("#theme_2_folder option").each(function(){var c=a(this).val();if(c==b)return void(d=0)}),!d)return alert("File with that name already exists."),void a("#theme_2_new_folder").focus();a("select theme_2_folder").prop("selected",!1);var e=a("<option></option>").val(b).html(c).prop("selected",!0);a("#theme_2_folder").append(e),a("#theme_2_new_folder_container").hide("slow"),a("#theme_2_new_folder").val(""),a("#theme_2_folder_contents").val("").focus()}),a("#theme_2_new_folder_btn_cancel").on("click",function(){a("#theme_2_new_folder").val(""),a("#theme_2_new_folder_container").hide("slow"),a(".status",a("#theme_2_new_folder_container")).text("").removeClass("app-alert-error")}),a("#theme_1").on("change",function(){app_load("#orbisius_ctc_theme_editor_theme_1_form","generate_dropdown","#theme_1_file",app_handle_theme_change)}),a("#theme_2").on("change",function(){app_load("#orbisius_ctc_theme_editor_theme_2_form","generate_dropdown","#theme_2_file",app_handle_theme_change)}),a("#orbisius_ctc_theme_editor_theme_1_form").submit(function(a){return app_load("#orbisius_ctc_theme_editor_theme_1_form","save_file","#theme_1_file_contents"),!1});var c=a("#theme_2").val();""!=c&&app_load("#orbisius_ctc_theme_editor_theme_2_form","generate_dropdown","#theme_2_file",app_handle_theme_change),a("#theme_2").on("change",function(){app_load("#orbisius_ctc_theme_editor_theme_2_form","generate_dropdown","#theme_2_file",app_handle_theme_change)}),a("#orbisius_ctc_theme_editor_theme_2_form").submit(function(){return app_load("#orbisius_ctc_theme_editor_theme_2_form","save_file","#theme_2_file_contents"),!1})}function app_handle_theme_change(a,b,c,d){var e=jQuery(a)?jQuery(a).attr("id"):"";if(e=e||"",""!=e){if(e=e.replace(/.+(theme[-_]*\d+).*/,"$1"),e="#"+e+"_","undefined"!=typeof OrbisiusChildThemeCreatorExt&&"undefined"!=typeof OrbisiusChildThemeCreatorExt.Editors&&"undefined"!=typeof OrbisiusChildThemeCreatorExt.Editors.onThemeChange){var f=e,f=f.replace(/_+$/g,"");OrbisiusChildThemeCreatorExt.Editors.onThemeChange(f,jQuery(f).val())}var g=jQuery(e+"_file").val();""!==g&&app_load(a,"load_file",e+"file_contents"),jQuery(e+"file").on("change",function(){app_load(a,"load_file",e+"file_contents")})}}function app_load(a,b,c,d){var e='<span class="app-alert-notice">Loading...</span>',f="Loading...",h=b.indexOf("save")>=0;h?(jQuery(c).is("input,textarea")&&(jQuery(c).attr("readonly","readonly"),jQuery(c).addClass("saving_action")),jQuery(".status",jQuery(c).parent()).html(e)):jQuery(c).is("input,textarea")?jQuery(c).addClass("saving_action"):jQuery(c).is("select")?jQuery(c+" option").text(f):jQuery(c).html(e),jQuery.ajax({type:"post",url:ajaxurl,data:jQuery(a).serialize()+"&action=orbisius_ctc_theme_editor_ajax&sub_cmd="+escape(b),success:function(e){var f={form_id:a,sub_cmd:b,result:e};if(""!=e){if(jQuery(c).is("input,textarea")?(jQuery(c).val(e),jQuery(c).is("textarea")&&jQuery(c).trigger("orbisius_child_theme_editor_event_file_loaded",f)):(jQuery(c).html(e),jQuery(c).trigger("orbisius_child_theme_editor_event_content_loaded",f)),h){jQuery(".status",jQuery(c).parent()).html("Saved.").addClass("app-alert-success"),setTimeout(function(){jQuery(".status",jQuery(c).parent()).empty().removeClass("app-alert-success app-alert-error")},2e3);var f={target:jQuery(c),event:{}};jQuery(document).trigger("orbisius_child_theme_editor_event_content_saved",[f])}}else h&&jQuery(".status",jQuery(c).parent()).html("Oops. Cannot save.").addClass("app-alert-error");"undefined"!=typeof d&&d(a,b,c,e)},beforeSend:function(){orbisius_child_theme_creator.loader(1)},complete:function(a){orbisius_child_theme_creator.loader(0),jQuery(c).removeClass("saving_action"),h&&jQuery(c).is("input,textarea")&&jQuery(c).removeAttr("readonly")}})}var orbisius_child_theme_creator={loader:function(a){var b=jQuery(".orbisius_child_theme_creator_container .loader");a?jQuery(b).html("Please Wait ...").show():jQuery(b).html("").hide()},sanitize_file_name:function(a){return a=a.replace(/[^\w\-\.\s\/\\]/gi,""),a=a.replace(/\s+/gi,"-"),a=a.replace(/\.+/gi,"."),a=a.replace(/-+/gi,"-"),a=a.replace(/_+/gi,"_"),a=a.replace(/^[._-]+/gi,""),a=a.replace(/[._-]+$/gi,""),a=jQuery.trim(a)},delete_file:function(a,b){jQuery.ajax({type:"post",url:ajaxurl,data:jQuery(b).serialize()+"&action=orbisius_ctc_theme_editor_ajax&sub_cmd="+escape("delete_file"),beforeSend:function(){orbisius_child_theme_creator.loader(1)},complete:function(){orbisius_child_theme_creator.loader(0)},success:function(a){var c=b.indexOf("theme_1")>=0?1:2;jQuery("#theme_"+c+"_file option:selected").remove(),jQuery("#theme_"+c+"_file").trigger("change")}})}};jQuery(document).ready(function(a){orbisius_ctc_theme_editor_setup()});